<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Tamagocho</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root { --bg1:#101820; --bg2:#1b3a3a; --card:#162429; --text:#eaf2f2; --accent:#87ceeb; --good:#41d695; --warn:#ffb84d; }
    *{box-sizing:border-box}
    body{
      margin:0; min-height:100dvh; display:flex; align-items:center; justify-content:center;
      background: radial-gradient(65% 65% at 50% 30%, var(--bg2), var(--bg1));
      color:var(--text); font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }
    .app{
      width:min(900px, 94vw); background:rgba(22,36,41,.7); border:1px solid rgba(255,255,255,.06);
      backdrop-filter: blur(8px); border-radius:24px; padding:20px; box-shadow:0 20px 40px rgba(0,0,0,.35);
    }
    .top{display:flex; gap:18px; align-items:center; justify-content:space-between; flex-wrap:wrap}
    h1{font-size:24px; margin:0}
    .user{opacity:.8; font-size:14px}
    .pet{
      display:grid; grid-template-columns: 280px 1fr; gap:20px; align-items:center; margin-top:14px;
    }
    .pet .imgWrap{
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border-radius:20px; padding:14px; display:flex; align-items:center; justify-content:center;
    }
    .pet img{ width:100%; height:auto; border-radius:16px; display:block; }
    .stats{ display:grid; gap:12px }
    .bar{ background:rgba(255,255,255,.08); border-radius:12px; overflow:hidden; height:16px; position:relative }
    .bar>span{ position:absolute; inset:0; width:0; transition:width .35s ease; }
    .bar.food>span{ background:linear-gradient(90deg, var(--good), #2fbf83) }
    .bar.mood>span{ background:linear-gradient(90deg, #ffc857, var(--warn)) }
    .bar.energy>span{ background:linear-gradient(90deg, #8aa5ff, #6a8cff) }
    .labels{ display:flex; justify-content:space-between; font-size:13px; margin-top:4px; opacity:.9 }
    .actions{ display:flex; flex-wrap:wrap; gap:10px; margin-top:18px }
    .btn{
      background:var(--accent); color:#001018; border:0; padding:12px 16px; border-radius:12px; cursor:pointer; font-weight:600;
      box-shadow: 0 6px 16px rgba(135,206,235,.35);
    }
    .btn.secondary{ background:#2b3d43; color:#e9f1f1; box-shadow:none; border:1px solid rgba(255,255,255,.06) }
    .footer{ margin-top:14px; font-size:12px; opacity:.7; text-align:center }
    @media (max-width:720px){ .pet{ grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <div class="app">
    <div class="top">
      <h1>üêπ Tamagocho</h1>
      <div class="user" id="hello">–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶</div>
    </div>

    <div class="pet">
      <div class="imgWrap">
        <!-- —Ç–µ–ø–µ—Ä—å –ø—É—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π -->
        <img src="./pet.webp" alt="–ü–∏—Ç–æ–º–µ—Ü" loading="eager">
      </div>

      <div class="right">
        <div class="stats">
          <div>
            <div class="labels"><span>–°—ã—Ç–æ—Å—Ç—å</span><span id="foodVal">0%</span></div>
            <div class="bar food"><span id="foodBar"></span></div>
          </div>
          <div>
            <div class="labels"><span>–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ</span><span id="moodVal">0%</span></div>
            <div class="bar mood"><span id="moodBar"></span></div>
          </div>
          <div>
            <div class="labels"><span>–≠–Ω–µ—Ä–≥–∏—è</span><span id="energyVal">0%</span></div>
            <div class="bar energy"><span id="energyBar"></span></div>
          </div>
        </div>

        <div class="actions">
          <button class="btn" onclick="act('feed')">üçó –ö–æ—Ä–º–∏—Ç—å</button>
          <button class="btn" onclick="act('play')">üé≤ –ò–≥—Ä–∞—Ç—å</button>
          <button class="btn secondary" onclick="act('sleep')">üí§ –°–ø–∞—Ç—å</button>
          <button class="btn secondary" onclick="resetPet()">üîÅ –°–±—Ä–æ—Å</button>
          <button class="btn" onclick="donate()">‚≠ê –ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å</button>
        </div>
      </div>
    </div>

    <div class="footer">–ü—Ä–æ–≥—Ä–µ—Å—Å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ. Mini App –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Telegram WebApp SDK.</div>
  </div>

  <script>
    const tg = window.Telegram?.WebApp;
    tg?.ready?.();

    const uid = tg?.initDataUnsafe?.user?.id || 'guest';
    const KEY = `tamagocho_state_${uid}`;

    const state = JSON.parse(localStorage.getItem(KEY) || '{}');
    let pet = {
      food: clamp(state.food ?? 70),
      mood: clamp(state.mood ?? 70),
      energy: clamp(state.energy ?? 70),
      last: Date.now()
    };

    const el = {
      hello: document.getElementById('hello'),
      foodBar: document.getElementById('foodBar'), foodVal: document.getElementById('foodVal'),
      moodBar: document.getElementById('moodBar'), moodVal: document.getElementById('moodVal'),
      energyBar: document.getElementById('energyBar'), energyVal: document.getElementById('energyVal'),
    };

    el.hello.textContent = `–ü—Ä–∏–≤–µ—Ç, ${tg?.initDataUnsafe?.user?.first_name || '–¥—Ä—É–≥'}!`;

    function clamp(v){ return Math.max(0, Math.min(100, Math.round(v))) }
    function save(){ localStorage.setItem(KEY, JSON.stringify(pet)) }
    function render(){
      el.foodBar.style.width   = pet.food   + '%'; el.foodVal.textContent   = pet.food   + '%';
      el.moodBar.style.width   = pet.mood   + '%'; el.moodVal.textContent   = pet.mood   + '%';
      el.energyBar.style.width = pet.energy + '%'; el.energyVal.textContent = pet.energy + '%';
    }

    function act(type){
      if(type==='feed') pet.food=clamp(pet.food+10);
      if(type==='play') pet.mood=clamp(pet.mood+10);
      if(type==='sleep') pet.energy=clamp(pet.energy+10);
      save(); render();
    }

    function resetPet(){
      pet={food:70,mood:70,energy:70,last:Date.now()};
      save(); render();
    }

    function donate(){
      tg?.showPopup?.({title:"–°–ø–∞—Å–∏–±–æ!",message:"–ó–¥–µ—Å—å –ø–æ–∑–∂–µ –±—É–¥–µ—Ç –¥–æ–Ω–∞—Ç —á–µ—Ä–µ–∑ Telegram Stars ‚ú®"});
    }

    render();
  </script>
</body>
</html>

