<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tamagocho</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <!-- Three.js (ESM) -->
  <script type="importmap">
  {
    "imports": {
      "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
      "three/examples/jsm/controls/OrbitControls.js": "https://unpkg.com/three@0.160.0/examples/jsm/controls/OrbitControls.js",
      "three/examples/jsm/loaders/GLTFLoader.js": "https://unpkg.com/three@0.160.0/examples/jsm/loaders/GLTFLoader.js"
    }
  }
  </script>

  <style>
    :root{
      --bg:#0d1117;
      --card:#161b22;
      --ink:#e6edf3;
      --muted:#8b949e;
      --btn:#21262d;
      --btn-hover:#30363d;
      --brand:#58a6ff;
      --good:#3fb950;
      --warn:#f0883e;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:var(--bg);
      color:var(--ink);
    }
    .wrap{max-width:420px;margin:0 auto;padding:16px}

    .card{
      background:var(--card);
      border-radius:16px;
      padding:12px;
      box-shadow:0 10px 24px rgba(0,0,0,.35);
      position:relative;
    }
    .header{
      display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;
      font-weight:600;
    }
    #seeds{font-variant-numeric:tabular-nums}

    /* 3D */
    .pet3d{
      width:100%;height:360px;border-radius:16px;overflow:hidden;
      background: radial-gradient(120% 120% at 50% 90%, #2c4a72 0%, #141e2b 70%);
      margin-bottom:16px;position:relative;z-index:0;
    }
    .pet3d canvas{display:block;width:100%!important;height:100%!important}
    /* —á—Ç–æ–±—ã –∫–∞–Ω–≤–∞—Å –Ω–µ –º–µ—à–∞–ª –∫–ª–∏–∫–∞–º –ø–æ –¥—Ä—É–≥–∏–º –∑–æ–Ω–∞–º */
    .pet3d{pointer-events:auto}
    .buttons{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-top:8px}
    .btn{
      background:var(--btn);border-radius:12px;padding:12px;text-align:center;cursor:pointer;
      transition:background .15s; user-select:none;
    }
    .btn:hover{background:var(--btn-hover)}
    .btn:active{transform:translateY(1px)}

    /* –°—Ç–∞—Ç—É—Å—ã */
    .bars{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:12px}
    .bar{background:var(--btn);border-radius:10px;padding:8px;font-size:14px}
    .bar span{display:block;margin-bottom:6px;color:var(--muted)}
    .progress{height:6px;border-radius:4px;background:#3a3f44;overflow:hidden}
    .progress>div{height:100%;background:var(--brand);width:50%}

    /* -------- –ú–æ–¥–∞–ª–∫–∏ -------- */
    .modal{
      position:fixed;inset:0;display:none;place-items:center;
      background:rgba(0,0,0,.45);
      z-index:50;
    }
    .modal.open{display:grid}
    .sheet{
      width:min(420px,90vw);max-height:85vh;overflow:auto;
      background:var(--card);border-radius:16px;padding:12px;
      box-shadow:0 18px 48px rgba(0,0,0,.5);animation:pop .15s ease;
    }
    @keyframes pop{from{transform:scale(.97);opacity:.6}to{transform:scale(1);opacity:1}}
    .sheet-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
    .x{background:var(--btn);border:none;color:var(--ink);width:32px;height:32px;border-radius:10px;cursor:pointer}
    .row{display:flex;align-items:center;justify-content:space-between;background:var(--btn);padding:10px;border-radius:10px;margin:8px 0}
    .tag{font-size:12px;padding:2px 8px;border-radius:999px;background:#3a3f44;margin-left:8px}
    .primary{background:var(--good);border:none;color:#04110a;border-radius:10px;padding:8px 12px;cursor:pointer}
    .ghost{background:var(--btn);border:none;color:var(--ink);border-radius:10px;padding:8px 12px;cursor:pointer}
    .muted{color:var(--muted)}
    .grid2{display:grid;grid-template-columns:1fr auto;gap:8px}

    .hidden{display:none!important}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="header">
        <div>üêπ Tamagocho</div>
        <div>Seeds: <span id="seeds">0</span></div>
      </div>

      <!-- 3D-—Ö–æ–º—è–∫ -->
      <div id="pet3d" class="pet3d"></div>

      <!-- –∫–Ω–æ–ø–∫–∏ -->
      <div class="buttons">
        <div class="btn" data-modal="shop">üõí –ú–∞–≥–∞–∑–∏–Ω</div>
        <div class="btn" data-modal="inv">üéí –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</div>
        <div class="btn" data-modal="quests">üìñ –ö–≤–µ—Å—Ç—ã</div>
        <div class="btn" data-modal="mini">üéÆ –ú–∏–Ω–∏-–∏–≥—Ä–∞</div>
        <div class="btn" data-modal="top">üèÜ –õ–∏–¥–µ—Ä–±–æ—Ä–¥</div>
        <div class="btn" data-modal="admin">‚öôÔ∏è –ê–¥–º–∏–Ω</div>
      </div>

      <!-- —Å—Ç–∞—Ç—É—Å—ã -->
      <div class="bars">
        <div class="bar">
          <span>‚ù§Ô∏è –°—ã—Ç–æ—Å—Ç—å</span>
          <div class="progress"><div id="bar_hunger" style="width:80%"></div></div>
        </div>
        <div class="bar">
          <span>‚ö° –≠–Ω–µ—Ä–≥–∏—è</span>
          <div class="progress"><div id="bar_energy" style="width:75%"></div></div>
        </div>
        <div class="bar">
          <span>üòä –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ</span>
          <div class="progress"><div id="bar_mood" style="width:90%"></div></div>
        </div>
      </div>
    </div>
  </div>

  <!-- --------- –ú–û–î–ê–õ–ö–ò --------- -->

  <!-- –ú–∞–≥–∞–∑–∏–Ω -->
  <div class="modal" id="modal_shop" role="dialog" aria-modal="true">
    <div class="sheet">
      <div class="sheet-head">
        <h3 style="margin:6px 0">üõí –ú–∞–≥–∞–∑–∏–Ω</h3>
        <button class="x" data-close>‚úñ</button>
      </div>

      <div class="row">
        <div>
          <div><b>–ú–∏—Å–∫–∞ —Å–µ–º–µ—á–µ–∫</b></div>
          <div class="muted">–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç —Å—ã—Ç–æ—Å—Ç—å –Ω–∞ 100%</div>
        </div>
        <button class="primary" data-buy="food" data-price="30">–ö—É–ø–∏—Ç—å ‚Äî 30</button>
      </div>

      <div class="row">
        <div>
          <div><b>–ü–æ–π–∏–ª–∫–∞</b></div>
          <div class="muted">–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç —ç–Ω–µ—Ä–≥–∏—é –Ω–∞ 100%</div>
        </div>
        <button class="primary" data-buy="energy" data-price="30">–ö—É–ø–∏—Ç—å ‚Äî 30</button>
      </div>

      <div class="row">
        <div>
          <div><b>–ü—Ä–µ–º–∏—É–º-–∫–æ—Ä–º XL</b> <span class="tag">–ü—Ä–µ–º–∏—É–º</span></div>
          <div class="muted">–°—Ä–∞–∑—É –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</div>
        </div>
        <button class="ghost" disabled title="–ü–æ–¥–∫–ª—é—á–∏–º –ø–æ–∑–∂–µ">–ü–æ–ª—É—á–∏—Ç—å</button>
      </div>

      <div class="row">
        <div>
          <div><b>–ë–∞–Ω—Ç–∏–∫</b> <span class="tag">–ê–∫—Å–µ—Å—Å—É–∞—Ä</span></div>
        </div>
        <button class="primary" data-acc="bow" data-price="40">–ö—É–ø–∏—Ç—å ‚Äî 40</button>
      </div>
    </div>
  </div>

  <!-- –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å -->
  <div class="modal" id="modal_inv">
    <div class="sheet">
      <div class="sheet-head">
        <h3 style="margin:6px 0">üéí –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</h3>
        <button class="x" data-close>‚úñ</button>
      </div>
      <div id="inv_list" class="muted">–ü–æ–∫–∞ –ø—É—Å—Ç–æ‚Ä¶</div>
    </div>
  </div>

  <!-- –ö–≤–µ—Å—Ç—ã -->
  <div class="modal" id="modal_quests">
    <div class="sheet">
      <div class="sheet-head">
        <h3 style="margin:6px 0">üìñ –ö–≤–µ—Å—Ç—ã</h3>
        <button class="x" data-close>‚úñ</button>
      </div>
      <div class="row">
        <div>
          <div><b>–£–≥–æ—Å—Ç–∏ —Ö–æ–º—è–∫–∞</b></div>
          <div class="muted">–°—ã–≥—Ä–∞–π –≤ –∫–ª–∏–∫–µ—Ä –∏ –Ω–∞–±–µ—Ä–∏ 50 –æ—á–∫–æ–≤</div>
        </div>
        <button class="primary" data-start-mini>–ù–∞—á–∞—Ç—å</button>
      </div>
    </div>
  </div>

  <!-- –ú–∏–Ω–∏-–∏–≥—Ä–∞ (–∫–ª–∏–∫–µ—Ä) -->
  <div class="modal" id="modal_mini">
    <div class="sheet">
      <div class="sheet-head">
        <h3 style="margin:6px 0">üéÆ –ú–∏–Ω–∏-–∏–≥—Ä–∞ | –ö–ª–∏–∫–µ—Ä</h3>
        <button class="x" data-close>‚úñ</button>
      </div>
      <p class="muted">–ö–ª–∏–∫–∞–π –ø–æ –∑–æ–Ω–µ –Ω–∏–∂–µ –∫–∞–∫ –º–æ–∂–Ω–æ –±—ã—Å—Ç—Ä–µ–µ –∑–∞ 10 —Å–µ–∫—É–Ω–¥. –ù–∞–≥—Ä–∞–¥–∞ ‚Äî Seeds.</p>
      <div id="click_area" style="height:200px;border-radius:12px;background:#0f1720"></div>
      <div class="grid2" style="margin-top:8px">
        <div class="muted">–û—á–∫–∏: <b id="score">0</b> ¬∑ –í—Ä–µ–º—è: <b id="time">10</b></div>
        <button class="primary" id="start_game">‚ñ∂ –°—Ç–∞—Ä—Ç</button>
      </div>
    </div>
  </div>

  <!-- –õ–∏–¥–µ—Ä–±–æ—Ä–¥ -->
  <div class="modal" id="modal_top">
    <div class="sheet">
      <div class="sheet-head">
        <h3 style="margin:6px 0">üèÜ –õ–∏–¥–µ—Ä–±–æ—Ä–¥ (–ª–æ–∫–∞–ª—å–Ω—ã–π)</h3>
        <button class="x" data-close>‚úñ</button>
      </div>
      <ol id="top_list" style="margin:0;padding-left:18px"></ol>
      <p class="muted" style="margin-top:8px">–ì–ª–æ–±–∞–ª—å–Ω—ã–π –≤–∫–ª—é—á–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –∫–æ–≥–¥–∞ –¥–æ–±–∞–≤–∏–º –±—ç–∫–µ–Ω–¥.</p>
    </div>
  </div>

  <!-- –ê–¥–º–∏–Ω (–≤–∏–¥–Ω–æ —Ç–æ–ª—å–∫–æ ID 1907547038) -->
  <div class="modal" id="modal_admin">
    <div class="sheet">
      <div class="sheet-head">
        <h3 style="margin:6px 0">‚öôÔ∏è –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å (—Å–æ–∑–¥–∞—Ç–µ–ª—å)</h3>
        <button class="x" data-close>‚úñ</button>
      </div>
      <div class="row">
        <div class="grid2" style="width:100%">
          <input id="give_seeds" type="number" value="100" min="1"
                 style="background:var(--btn);border:none;color:var(--ink);border-radius:10px;padding:10px">
          <button class="primary" id="btn_give_seeds">–í—ã–¥–∞—Ç—å</button>
        </div>
      </div>
      <div class="row">
        <div class="grid2" style="width:100%">
          <select id="acc_select" style="background:var(--btn);color:var(--ink);border:none;border-radius:10px;padding:10px">
            <option value="bow">–ë–∞–Ω—Ç–∏–∫</option>
          </select>
          <button class="primary" id="btn_give_acc">–í—ã–¥–∞—Ç—å</button>
        </div>
      </div>
      <p class="muted">–≠—Ç–æ –Ω–µ –¥–æ–Ω–∞—Ç, –∞ —É–¥–æ–±–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞—Ç–µ–ª—è. –í–∏–¥–∏—à—å —Ç–æ–ª—å–∫–æ —Ç—ã.</p>
    </div>
  </div>

  <!-- ---------------- three.js + –õ–û–ì–ò–ö–ê UI ---------------- -->
  <script type="module">
    /* ----------------- three.js ----------------- */
    import * as THREE from "three";
    import { OrbitControls } from "three/examples/jsm/controls/OrbitControls.js";
    import { GLTFLoader } from "three/examples/jsm/loaders/GLTFLoader.js";

    const mount = document.getElementById("pet3d");
    let renderer, scene, camera, controls, hamster, ground;

    scene = new THREE.Scene();
    const aspect = mount.clientWidth / mount.clientHeight;
    camera = new THREE.PerspectiveCamera(45, aspect, 0.01, 100);
    camera.position.set(0.6, 0.35, 1.2);

    renderer = new THREE.WebGLRenderer({ antialias:true, alpha:true });
    renderer.setPixelRatio(Math.min(devicePixelRatio, 2));
    renderer.setSize(mount.clientWidth, mount.clientHeight);
    renderer.outputColorSpace = THREE.SRGBColorSpace;
    renderer.shadowMap.enabled = true;
    mount.appendChild(renderer.domElement);

    scene.add(new THREE.HemisphereLight(0xffffff, 0x101018, 1.1));
    const dir = new THREE.DirectionalLight(0xffffff, 1.6);
    dir.position.set(1.2, 1.6, 1);
    dir.castShadow = true;
    dir.shadow.mapSize.set(1024,1024);
    scene.add(dir);

    const groundGeo = new THREE.CircleGeometry(0.6, 64);
    const groundMat = new THREE.ShadowMaterial({ opacity: .28 });
    ground = new THREE.Mesh(groundGeo, groundMat);
    ground.rotation.x = -Math.PI/2; ground.receiveShadow = true;
    scene.add(ground);

    controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.enablePan = false;
    controls.minDistance = .5; controls.maxDistance = 2;
    controls.minPolarAngle = Math.PI*.2;
    controls.maxPolarAngle = Math.PI*.49;

    const loader = new GLTFLoader();
    const MODEL_URL = "./hamster.glb";
    loader.load(MODEL_URL, (gltf)=>{
      hamster = gltf.scene;
      hamster.traverse(o=>{ if(o.isMesh){ o.castShadow = true; o.receiveShadow = true; }});
      scene.add(hamster);
      fitAndCenter(hamster);
      animate();
    }, undefined, (e)=>console.error("GLB load error", e));

    function fitAndCenter(obj){
      const box = new THREE.Box3().setFromObject(obj);
      const size = box.getSize(new THREE.Vector3());
      const center = box.getCenter(new THREE.Vector3());
      obj.position.sub(center);
      const scale = .45 / size.y;
      obj.scale.setScalar(scale);

      const box2 = new THREE.Box3().setFromObject(obj);
      const sphere = box2.getBoundingSphere(new THREE.Sphere());
      const fov = camera.fov * Math.PI/180;
      const dist = Math.max(
        box2.getSize(new THREE.Vector3()).y / (2*Math.tan(fov/2)),
        box2.getSize(new THREE.Vector3()).x / (2*Math.tan(fov/2))
      );
      camera.position.set(sphere.center.x+dist*.6, sphere.center.y+dist*.35, sphere.center.z+dist*1.2);
      controls.target.copy(sphere.center); controls.update();
      ground.position.set(sphere.center.x, box2.min.y-0.001, sphere.center.z);
      ground.scale.set(1.2,1.2,1.2);
    }

    function animate(){
      requestAnimationFrame(animate);
      controls.update();
      renderer.render(scene, camera);
    }
    function onResize(){
      const w = mount.clientWidth, h = mount.clientHeight;
      camera.aspect = w/h; camera.updateProjectionMatrix();
      renderer.setSize(w,h);
    }
    addEventListener("resize", onResize);
    new ResizeObserver(onResize).observe(mount);

    /* ----------------- –ò–ì–†–û–í–ê–Ø –õ–û–ì–ò–ö–ê ----------------- */
    const tg = window.Telegram?.WebApp;
    tg && tg.ready && tg.ready();

    const CREATOR_ID = 1907547038; // —Ç–≤–æ–π ID
    const seedsEl = document.getElementById("seeds");
    const bars = {
      hunger: document.getElementById("bar_hunger"),
      energy: document.getElementById("bar_energy"),
      mood: document.getElementById("bar_mood"),
    };

    // —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    const S = JSON.parse(localStorage.getItem("tamagocho_state") || "{}");
    const state = {
      seeds: S.seeds ?? 0,
      hunger: S.hunger ?? 0.8,
      energy: S.energy ?? 0.75,
      mood:   S.mood   ?? 0.9,
      inv:    S.inv    ?? [],
      top:    S.top    ?? [],
      userId: tg?.initDataUnsafe?.user?.id ?? null
    };
    save(); render();

    function save(){ localStorage.setItem("tamagocho_state", JSON.stringify(state)); }
    function render(){
      seedsEl.textContent = state.seeds;
      bars.hunger.style.width = Math.round(state.hunger*100)+"%";
      bars.energy.style.width = Math.round(state.energy*100)+"%";
      bars.mood.style.width   = Math.round(state.mood*100)+"%";
      // –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å
      const inv = state.inv.length ? `<ul style="margin:0;padding-left:18px">${state.inv.map(i=>`<li>${i}</li>`).join("")}</ul>` : "–ü–æ–∫–∞ –ø—É—Å—Ç–æ‚Ä¶";
      document.getElementById("inv_list").innerHTML = inv;
      // —Ç–æ–ø
      const topList = document.getElementById("top_list");
      topList.innerHTML = (state.top.slice(0,10).map((t,i)=>`<li>${t.name}: ${t.score}</li>`).join("")) || "<span class='muted'>–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π‚Ä¶</span>";
      // –∞–¥–º–∏–Ω –¥–æ—Å—Ç—É–ø
      document.querySelector('[data-modal="admin"]').parentElement.parentElement
      const adminBtn = document.querySelector('[data-modal="admin"]');
      if (state.userId !== CREATOR_ID) adminBtn.classList.add("hidden"); else adminBtn.classList.remove("hidden");
    }

    /* --------- –º–æ–¥–∞–ª–∫–∏ --------- */
    const modals = {
      shop:  document.getElementById("modal_shop"),
      inv:   document.getElementById("modal_inv"),
      quests:document.getElementById("modal_quests"),
      mini:  document.getElementById("modal_mini"),
      top:   document.getElementById("modal_top"),
      admin: document.getElementById("modal_admin"),
    };
    document.querySelectorAll(".btn[data-modal]").forEach(b=>{
      b.addEventListener("click", ()=>{
        const id = b.dataset.modal;
        openModal(modals[id]);
      });
    });
    document.querySelectorAll("[data-close]").forEach(x=>{
      x.addEventListener("click", ()=>closeModal(x.closest(".modal")));
    });
    Object.values(modals).forEach(m=>{
      m.addEventListener("click", e=>{ if(e.target === m) closeModal(m); });
    });
    function openModal(el){ el.classList.add("open"); }
    function closeModal(el){ el.classList.remove("open"); }

    /* --------- –º–∞–≥–∞–∑–∏–Ω --------- */
    document.querySelectorAll("[data-buy]").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        const type = btn.dataset.buy;
        const price = +btn.dataset.price;
        if (state.seeds < price) { toast("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ Seeds"); return; }
        state.seeds -= price;
        if (type==="food") state.hunger = 1;
        if (type==="energy") state.energy = 1;
        save(); render();
        toast("–ö—É–ø–ª–µ–Ω–æ!");
      });
    });
    document.querySelectorAll("[data-acc]").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        const price = +btn.dataset.price;
        const name = btn.dataset.acc;
        if (state.seeds < price) { toast("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ Seeds"); return; }
        state.seeds -= price;
        state.inv.push("–ê–∫—Å–µ—Å—Å—É–∞—Ä: "+name);
        save(); render();
        toast("–ê–∫—Å–µ—Å—Å—É–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å");
      });
    });

    /* --------- –∫–≤–µ—Å—Ç—ã: —Å—Ç–∞—Ä—Ç –º–∏–Ω–∏-–∏–≥—Ä—ã --------- */
    document.querySelectorAll("[data-start-mini]").forEach(b=>{
      b.addEventListener("click", ()=>{
        closeModal(modals.quests);
        openModal(modals.mini);
      });
    });

    /* --------- –º–∏–Ω–∏-–∏–≥—Ä–∞ (–∫–ª–∏–∫–µ—Ä) --------- */
    let timer=null, timeLeft=10, score=0;
    const elScore = document.getElementById("score");
    const elTime  = document.getElementById("time");
    const area = document.getElementById("click_area");
    document.getElementById("start_game").addEventListener("click", startGame);
    area.addEventListener("click", ()=>{ if(timer){ score++; elScore.textContent=score; } });

    function startGame(){
      score=0; timeLeft=10; elScore.textContent=score; elTime.textContent=timeLeft;
      if (timer) { clearInterval(timer); timer=null; }
      timer = setInterval(()=>{
        timeLeft--; elTime.textContent=timeLeft;
        if (timeLeft<=0){ clearInterval(timer); timer=null; finishGame(); }
      },1000);
    }
    function finishGame(){
      const reward = Math.min(100, score); // –ø—Ä–æ—Å—Ç–∞—è —Ñ–æ—Ä–º—É–ª–∞
      state.seeds += reward;
      // –ª–æ–∫–∞–ª—å–Ω—ã–π —Ç–æ–ø
      state.top.unshift({name:"–¢—ã", score});
      state.top = state.top.slice(0,20);
      save(); render();
      toast(`+${reward} Seeds –∑–∞ ${score} –∫–ª–∏–∫–æ–≤`);
    }

    /* --------- –∞–¥–º–∏–Ω–∫–∞ --------- */
    document.getElementById("btn_give_seeds").addEventListener("click", ()=>{
      if (state.userId !== CREATOR_ID) return toast("–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞");
      const val = Math.max(1, +document.getElementById("give_seeds").value||0);
      state.seeds += val; save(); render(); toast(`–í—ã–¥–∞–ª ${val} Seeds`);
    });
    document.getElementById("btn_give_acc").addEventListener("click", ()=>{
      if (state.userId !== CREATOR_ID) return toast("–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞");
      const v = document.getElementById("acc_select").value;
      state.inv.push("–ê–∫—Å–µ—Å—Å—É–∞—Ä: "+v); save(); render(); toast("–ê–∫—Å–µ—Å—Å—É–∞—Ä –≤—ã–¥–∞–Ω");
    });

    /* --------- —É—Ç–∏–ª–∏—Ç—ã --------- */
    function toast(text){
      if (tg?.showPopup){ tg.showPopup({title:"", message:text, buttons:[{type:"ok"}]}); return; }
      // fallback
      alert(text);
    }
  </script>
</body>
</html>
