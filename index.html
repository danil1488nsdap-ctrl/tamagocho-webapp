<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tamagocho</title>

  <!-- Telegram Mini App SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    :root{
      --bg:#0f1620;--card:#151e2f;--text:#e6eef8;--muted:#9bb2d0;
      --accent:#80de6b;--ok:#34d399;--warn:#f59e0b;--danger:#ef4444;
      --deep:#0b1320;--panel:#101a2a;--border:rgba(255,255,255,.06)
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;background:var(--bg);color:var(--text);
      font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif
    }
    .wrap{max-width:420px;margin:0 auto;padding:18px 16px 32px}
    .card{
      background:var(--card);border-radius:18px;padding:14px 14px 4px;
      box-shadow:0 10px 28px rgba(0,0,0,.35)
    }
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .header{
      display:flex;align-items:center;gap:12px;margin-bottom:12px
    }
    .avatar{width:72px;height:72px;border-radius:16px;object-fit:cover;background:#000}
    .title{font-size:18px;font-weight:700}
    .muted{color:var(--muted);font-size:13px}
    .panel{background:var(--panel);border-radius:14px;padding:12px;border:1px solid var(--border)}
    .btn{
      display:flex;align-items:center;justify-content:center;gap:8px;
      height:44px;padding:0 14px;border-radius:12px;
      background:#0f1a2b;border:1px solid var(--border);color:var(--text);
      cursor:pointer;user-select:none;transition:.2s
    }
    .btn:hover{filter:brightness(1.1)}
    .btn.primary{background:#183049}
    .btn.success{background:#0d3528;border-color:#0f5132}
    .btn.warn{background:#3a2b07;border-color:#7c5c0a}
    .btn.ghost{background:transparent}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .stats{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px}
    .bar{height:8px;background:#0a1220;border-radius:8px;overflow:hidden; border:1px solid var(--border)}
    .fill{height:100%;background:linear-gradient(90deg,#1dd881,#0fb56b)}
    .fill.yellow{background:linear-gradient(90deg,#ffd54a,#ffb300)}
    .fill.blue{background:linear-gradient(90deg,#63b3ff,#3182ce)}
    .kpi{display:flex;align-items:center;justify-content:space-between;margin-bottom:6px}
    .kpi .name{font-size:13px;color:var(--muted)}
    .kpi .val{font-weight:700}
    .toolbar{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:8px}
    .toolbar .btn{height:36px;font-size:13px}
    .menu{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin:12px 0 6px}
    .tile{
      background:#0f1a2b;border:1px solid var(--border);border-radius:14px;height:60px;
      display:flex;align-items:center;justify-content:center;gap:8px;font-weight:700;cursor:pointer
    }
    .tile:hover{filter:brightness(1.1)}
    .pad{padding:12px}
    .modal{
      position:fixed;inset:0;display:none;align-items:flex-end;justify-content:center;background:rgba(0,0,0,.45)
    }
    .modal.open{display:flex}
    .sheet{width:100%;max-width:420px;background:var(--card);border-radius:18px 18px 0 0;border:1px solid var(--border)}
    .sheet .head{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid var(--border)}
    .list{display:flex;flex-direction:column;padding:8px 12px;max-height:60vh;overflow:auto;gap:10px}
    .item{display:flex;align-items:center;justify-content:space-between;background:var(--panel);border:1px solid var(--border);border-radius:12px;padding:12px}
    .item .meta{display:flex;flex-direction:column;gap:4px}
    .badge{font-size:11px;padding:2px 6px;border-radius:999px;background:#2e2538;color:#d8b4fe;border:1px solid rgba(255,255,255,.08);display:inline-flex;gap:4px;align-items:center}
    .note{font-size:12px;color:var(--muted);padding:10px 14px;border-top:1px dashed var(--border)}
    canvas{display:block;width:100%;height:260px;background:#0c1524;border-radius:14px;border:1px solid var(--border)}
    .viewer{padding:8px 8px 0}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="header">
        <img class="avatar" src="https://i.imgur.com/3r3VqQ8.jpeg" alt="pet" />
        <div>
          <div class="title">Tamagocho</div>
          <div class="muted" id="seedsLabel">Seeds: 0</div>
        </div>
      </div>

      <!-- –ú–µ–Ω—é -->
      <div class="menu">
        <div class="tile" id="openShop">üõçÔ∏è –ú–∞–≥–∞–∑–∏–Ω</div>
        <div class="tile" id="openInv">üß∞ –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</div>
        <div class="tile" id="openQuests">üó∫Ô∏è –ö–≤–µ—Å—Ç—ã</div>
        <div class="tile" id="openMini">üéÆ –ú–∏–Ω–∏-–∏–≥—Ä–∞</div>
        <div class="tile" id="openLeaderboard">üèÜ –õ–∏–¥–µ—Ä–±–æ—Ä–¥</div>
        <div class="tile" id="openAdmin">‚öôÔ∏è –ê–¥–º–∏–Ω</div>
      </div>

      <!-- 3D —Å—Ü–µ–Ω–∞ -->
      <div class="panel viewer">
        <canvas id="scene"></canvas>
      </div>

      <!-- –°—Ç–∞—Ç—ã -->
      <div class="panel">
        <div class="stats">
          <div>
            <div class="kpi"><span class="name">–°—ã—Ç–æ—Å—Ç—å</span><span class="val" id="satietyVal">100%</span></div>
            <div class="bar"><div class="fill" id="satietyFill" style="width:100%"></div></div>
          </div>
          <div>
            <div class="kpi"><span class="name">–≠–Ω–µ—Ä–≥–∏—è</span><span class="val" id="energyVal">100%</span></div>
            <div class="bar"><div class="fill yellow" id="energyFill" style="width:100%"></div></div>
          </div>
          <div>
            <div class="kpi"><span class="name">–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ</span><span class="val" id="moodVal">100%</span></div>
            <div class="bar"><div class="fill blue" id="moodFill" style="width:100%"></div></div>
          </div>
        </div>

        <div class="toolbar">
          <button class="btn success" id="feedBtn">üçó –ü–æ–ª–Ω–∞—è</button>
          <button class="btn warn" id="sleepBtn">üîã –ü–æ–ª–Ω–∞—è</button>
        </div>
      </div>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª–∫–∏ -->
  <div class="modal" id="modalShop">
    <div class="sheet">
      <div class="head"><b>üõçÔ∏è –ú–∞–≥–∞–∑–∏–Ω</b><button class="btn ghost" data-close="modalShop">‚úñ</button></div>
      <div class="list" id="shopList"></div>
      <div class="note">–ü—Ä–µ–º–∏—É–º-–∞–∫—Å–µ—Å—Å—É–∞—Ä—ã –±—É–¥—É—Ç –∑–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –¥–µ–Ω—å–≥–∏ (–ø–æ–¥–∫–ª—é—á–∏–º –ø–æ–∑–∂–µ).</div>
    </div>
  </div>

  <div class="modal" id="modalInv">
    <div class="sheet">
      <div class="head"><b>üß∞ –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</b><button class="btn ghost" data-close="modalInv">‚úñ</button></div>
      <div class="list" id="invList"></div>
    </div>
  </div>

  <div class="modal" id="modalQuests">
    <div class="sheet">
      <div class="head"><b>üó∫Ô∏è –ö–≤–µ—Å—Ç—ã</b><button class="btn ghost" data-close="modalQuests">‚úñ</button></div>
      <div class="list" id="questsList"></div>
    </div>
  </div>

  <div class="modal" id="modalMini">
    <div class="sheet">
      <div class="head"><b>üéÆ –ú–∏–Ω–∏-–∏–≥—Ä–∞ | –ö–ª–∏–∫–µ—Ä</b><button class="btn ghost" data-close="modalMini">‚úñ</button></div>
      <div class="pad">
        <p class="muted">–ö–ª–∏–∫–∞–π –ø–æ –ø–ª–æ—â–∞–¥–∫–µ –∫–∞–∫ –º–æ–∂–Ω–æ –±—ã—Å—Ç—Ä–µ–µ 10 —Å–µ–∫—É–Ω–¥. –ù–∞–≥—Ä–∞–¥–∞ ‚Äî Seeds.</p>
        <div id="clickArea" style="height:160px;border:1px dashed var(--border);border-radius:10px;background:#0c1626;margin-bottom:8px"></div>
        <div class="row" style="justify-content:space-between;padding:0 4px 8px">
          <div>–û—á–∫–∏: <b id="clickScore">0</b></div>
          <div>–í—Ä–µ–º—è: <b id="clickTime">0</b></div>
        </div>
        <button class="btn primary" id="startMini">‚ñ∂ –°—Ç–∞—Ä—Ç</button>
      </div>
    </div>
  </div>

  <div class="modal" id="modalLb">
    <div class="sheet">
      <div class="head"><b>üèÜ –õ–∏–¥–µ—Ä–±–æ—Ä–¥ (–ª–æ–∫–∞–ª—å–Ω—ã–π)</b><button class="btn ghost" data-close="modalLb">‚úñ</button></div>
      <div class="list" id="lbList"></div>
      <div class="note">–ì–ª–æ–±–∞–ª—å–Ω—ã–π –ª–∏–¥–µ—Ä–±–æ—Ä–¥ –ø–æ–¥–∫–ª—é—á–∏–º, –∫–æ–≥–¥–∞ –≤–∫–ª—é—á–∏–º –±—ç–∫–µ–Ω–¥.</div>
    </div>
  </div>

  <div class="modal" id="modalAdmin">
    <div class="sheet">
      <div class="head"><b>‚öôÔ∏è –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å (—Å–æ–∑–¥–∞—Ç–µ–ª—å)</b><button class="btn ghost" data-close="modalAdmin">‚úñ</button></div>
      <div class="pad" id="adminWrap"></div>
    </div>
  </div>

  <!-- GAME LOGIC -->
  <script type="module">
    // ====== THREE IMPORTS ======
    import * as THREE from "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js";
    import { OrbitControls } from "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/controls/OrbitControls.js";
    import { GLTFLoader } from "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/loaders/GLTFLoader.js";

    // ====== TELEGRAM CONTEXT ======
    const tg = window.Telegram?.WebApp;
    tg?.ready();
    tg?.expand?.();

    const CREATOR_ID = 1907547038; // —Ç–≤–æ–π id
    const userId = tg?.initDataUnsafe?.user?.id ?? "localUser";
    const storageKey = `tama_state_${userId}`;
    const lbKey = "tama_lb_local";

    // ====== STATE (–Ω–∞–¥—ë–∂–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è) ======
    function safeNum(v, d){ return Number.isFinite(Number(v)) ? Number(v) : d }
    let state = {};
    try { state = JSON.parse(localStorage.getItem(storageKey) || "{}") } catch { state = {} }

    state.seeds     = safeNum(state.seeds, 250);
    state.satiety   = safeNum(state.satiety, 100);
    state.energy    = safeNum(state.energy, 100);
    state.mood      = safeNum(state.mood, 100);
    state.accessories = Array.isArray(state.accessories) ? state.accessories : [];

    function save(){ localStorage.setItem(storageKey, JSON.stringify(state)) }

    // ====== UI BINDINGS ======
    const seedsLabel  = document.getElementById("seedsLabel");
    const satietyVal  = document.getElementById("satietyVal");
    const energyVal   = document.getElementById("energyVal");
    const moodVal     = document.getElementById("moodVal");
    const satietyFill = document.getElementById("satietyFill");
    const energyFill  = document.getElementById("energyFill");
    const moodFill    = document.getElementById("moodFill");

    function clamp01(n){ return Math.max(0, Math.min(100, n)) }

    function render(){
      seedsLabel.textContent = `Seeds: ${state.seeds}`;
      satietyVal.textContent = `${clamp01(state.satiety)}%`;
      energyVal.textContent  = `${clamp01(state.energy)}%`;
      moodVal.textContent    = `${clamp01(state.mood)}%`;
      satietyFill.style.width = clamp01(state.satiety) + "%";
      energyFill.style.width  = clamp01(state.energy) + "%";
      moodFill.style.width    = clamp01(state.mood) + "%";
    }
    render();

    // ====== SIMPLE DECAY ======
    setInterval(()=>{
      state.satiety = clamp01(state.satiety - 0.15);
      state.energy  = clamp01(state.energy - 0.12);
      state.mood    = clamp01(state.mood - 0.08);
      save(); render();
    }, 3000);

    // ====== FEED / SLEEP ======
    document.getElementById("feedBtn").onclick = ()=>{
      if(state.seeds >= 10){
        state.seeds -= 10;
        state.satiety = 100;
        state.mood = clamp01(state.mood + 5);
        save(); render();
      } else tg?.showPopup?.({title:"–ú–∞–ª–æ Seeds", message:"–ù—É–∂–Ω–æ 10 Seeds."});
    }
    document.getElementById("sleepBtn").onclick = ()=>{
      state.energy = 100;
      state.mood = clamp01(state.mood + 3);
      save(); render();
    }

    // ====== MODALS HELPERS ======
    const byId = id => document.getElementById(id);
    function open(id){ byId(id).classList.add("open") }
    function close(id){ byId(id).classList.remove("open") }
    document.querySelectorAll("[data-close]").forEach(b=>{
      b.addEventListener("click",()=> close(b.getAttribute("data-close")));
    });

    // ====== SHOP / INVENTORY ======
    const SHOP = [
      { id:"bowl",    name:"–ú–∏—Å–∫–∞ —Å–µ–º–µ—á–µ–∫", type:"consumable", price:30, effect: s=>{s.satiety=100} },
      { id:"drinker", name:"–ü–æ–∏–ª–∫–∞",        type:"consumable", price:30, effect: s=>{s.energy =100} },
      { id:"xlfood",  name:"–ü—Ä–µ–º–∏—É–º-–∫–æ—Ä–º XL", type:"consumable", price:80, effect: s=>{s.satiety=100; s.mood=clamp01(s.mood+10)} },
      { id:"bow",   name:"–ë–∞–Ω—Ç–∏–∫", type:"premium", price:null },
      { id:"hat",   name:"–®–ª—è–ø–∞ –¥–∂–µ–Ω—Ç–ª—å–º–µ–Ω–∞", type:"premium", price:null },
      { id:"glasses",name:"–û—á–∫–∏ –∑–≤–µ–∑–¥—ã", type:"premium", price:null },
    ];

    function buildShop(){
      const root = byId("shopList"); root.innerHTML = "";
      SHOP.forEach(it=>{
        const row = document.createElement("div"); row.className="item";
        const meta = document.createElement("div"); meta.className="meta";
        const title = document.createElement("div"); title.textContent = it.name;
        const sub = document.createElement("div"); sub.className="muted"; sub.textContent = it.type==="consumable"?"–†–∞—Å—Ö–æ–¥–Ω–∏–∫":"–ê–∫—Å–µ—Å—Å—É–∞—Ä";
        meta.append(title, sub);
        const act = document.createElement("button"); act.className="btn";
        if(it.type==="consumable"){
          act.textContent = `–ö—É–ø–∏—Ç—å ‚Äî ${it.price}üü°`;
          act.onclick = ()=>{
            if(state.seeds>=it.price){
              state.seeds -= it.price;
              it.effect(state);
              save(); render();
              tg?.HapticFeedback?.notificationOccurred?.("success");
            } else tg?.showPopup?.({title:"–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ Seeds", message:"–ó–∞—Ä–∞–±–æ—Ç–∞–π –µ—â—ë –≤ –º–∏–Ω–∏-–∏–≥—Ä–µ –∏–ª–∏ –∫–≤–µ—Å—Ç–∞—Ö."})
          }
        }else{
          const badge = document.createElement("span"); badge.className="badge"; badge.textContent="–ü—Ä–µ–º–∏—É–º";
          title.append(" "); title.append(badge);
          act.textContent = "–ü–æ–ª—É—á–∏—Ç—å";
          act.onclick = ()=>{
            // –¥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –ÆKassa ‚Äî –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑–∞—Ç—å –∑–∞–≥–ª—É—à–∫—É
            tg?.showPopup?.({title:"–°–∫–æ—Ä–æ", message:"–ü—Ä–µ–º–∏—É–º-–∞–∫—Å–µ—Å—Å—É–∞—Ä—ã –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –æ–ø–ª–∞—Ç—ã."})
          }
        }
        row.append(meta, act);
        root.append(row);
      });
    }

    function buildInv(){
      const root = byId("invList"); root.innerHTML = "";
      if(!state.accessories.length){
        const empty = document.createElement("div"); empty.className="muted pad"; empty.textContent="–ü—É—Å—Ç–æ. –ö—É–ø–∏ –∞–∫—Å–µ—Å—Å—É–∞—Ä—ã –≤ –º–∞–≥–∞–∑–∏–Ω–µ.";
        root.append(empty); return;
      }
      state.accessories.forEach(a=>{
        const row = document.createElement("div"); row.className="item";
        row.innerHTML = `<div class="meta"><div>${a}</div><div class="muted">–ê–∫—Å–µ—Å—Å—É–∞—Ä</div></div>`;
        const btn = document.createElement("button"); btn.className="btn"; btn.textContent="–ù–∞–¥–µ—Ç—å";
        btn.onclick = ()=> tg?.showPopup?.({title:"–û–∫", message:`–ê–∫—Å–µ—Å—Å—É–∞—Ä ¬´${a}¬ª –Ω–∞–¥–µ—Ç (–≤–∏–∑—É–∞–ª –ø–æ–¥–∫–ª—é—á–∏–º –ø–æ–∑–∂–µ).`});
        row.append(btn); byId("invList").append(row);
      });
    }

    // ====== QUESTS ======
    const QUESTS = [
      { id:"q1", title:"–ù–∞–∫–æ—Ä–º–∏ —Ö–æ–º—è–∫–∞ 1 —Ä–∞–∑", reward:20, check: s=> s.satiety===100 },
      { id:"q2", title:"–ü–æ–ª–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è",        reward:15, check: s=> s.energy===100 },
      { id:"q3", title:"–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ ‚â• 90%",      reward:15, check: s=> s.mood>=90 },
    ];
    function buildQuests(){
      const root = byId("questsList"); root.innerHTML="";
      QUESTS.forEach(q=>{
        const row = document.createElement("div"); row.className="item";
        row.innerHTML = `<div class="meta"><div>${q.title}</div><div class="muted">+${q.reward} Seeds</div></div>`;
        const btn = document.createElement("button"); btn.className="btn"; btn.textContent="–ü–æ–ª—É—á–∏—Ç—å";
        btn.onclick = ()=>{
          if(q.check(state)){
            state.seeds += q.reward; save(); render();
            tg?.HapticFeedback?.notificationOccurred?.("success");
          } else tg?.showPopup?.({title:"–ï—â—ë –Ω–µ—Ç", message:"–£—Å–ª–æ–≤–∏–µ –∫–≤–µ—Å—Ç–∞ –ø–æ–∫–∞ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ."})
        }
        row.append(btn); root.append(row);
      })
    }

    // ====== MINI GAME ======
    let gameTimer=null, gameLeft=0, clicks=0;
    const area = byId("clickArea");
    byId("startMini").onclick = ()=>{
      clicks=0; gameLeft=10;
      byId("clickScore").textContent=clicks;
      byId("clickTime").textContent=gameLeft;
      area.style.pointerEvents="auto";
      gameTimer && clearInterval(gameTimer);
      gameTimer = setInterval(()=>{
        gameLeft--; byId("clickTime").textContent=gameLeft;
        if(gameLeft<=0){
          clearInterval(gameTimer); area.style.pointerEvents="none";
          const reward = Math.max(5, Math.floor(clicks/5));
          state.seeds += reward; save(); render();
          tg?.showPopup?.({title:"–†–∞—É–Ω–¥ –∑–∞–≤–µ—Ä—à—ë–Ω", message:`–ö–ª–∏–∫–æ–≤: ${clicks}\n–ù–∞–≥—Ä–∞–¥–∞: +${reward} Seeds`})
        }
      },1000);
    }
    area.onclick=()=>{ if(gameLeft>0){ clicks++; byId("clickScore").textContent=clicks } }

    // ====== LEADERBOARD (local) ======
    function loadLB(){ try{ return JSON.parse(localStorage.getItem(lbKey)||"[]") }catch{return[]} }
    function saveLB(list){ localStorage.setItem(lbKey, JSON.stringify(list)) }
    function pushLB(score){
      const list = loadLB();
      const name = (tg?.initDataUnsafe?.user?.first_name || "–ò–≥—Ä–æ–∫");
      list.push({ name, score, ts:Date.now() });
      list.sort((a,b)=> b.score-a.score);
      saveLB(list.slice(0,20));
    }
    function buildLB(){
      const root = byId("lbList"); root.innerHTML="";
      const list = loadLB();
      if(!list.length){ root.innerHTML = `<div class="muted pad">–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π. –°—ã–≥—Ä–∞–π –≤ –º–∏–Ω–∏-–∏–≥—Ä—É!</div>`; return }
      list.forEach((r,i)=>{
        const row = document.createElement("div"); row.className="item";
        row.innerHTML = `<div class="meta"><div>#${i+1} ‚Äî ${r.name}</div><div class="muted">${new Date(r.ts).toLocaleString()}</div></div><b>${r.score}</b>`;
        root.append(row);
      });
    }
    // –¥–æ–±–∞–≤–∏–º –∑–∞–ø–∏—Å—å –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Ä–∞—É–Ω–¥–∞
    area.addEventListener("click", ()=>{
      if(gameLeft===0 && clicks>0){
        pushLB(clicks); clicks=0;
      }
    });

    // ====== ADMIN (only creator) ======
    function buildAdmin(){
      const wrap = byId("adminWrap"); wrap.innerHTML="";
      if(+userId !== CREATOR_ID){ wrap.innerHTML=`<div class="muted">–î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ —Å–æ–∑–¥–∞—Ç–µ–ª—é.</div>`; return }
      const block = document.createElement("div");
      block.innerHTML = `
        <div class="row" style="margin-bottom:10px">
          <input id="giveAmount" value="100" class="panel" style="flex:1;outline:none;color:var(--text)" />
          <button class="btn success" id="giveSeeds">–í—ã–¥–∞—Ç—å</button>
        </div>
        <div class="row">
          <select id="accSel" class="panel" style="flex:1;outline:none;color:var(--text)">
            <option value="–ë–∞–Ω—Ç–∏–∫">–ë–∞–Ω—Ç–∏–∫</option>
            <option value="–®–ª—è–ø–∞ –¥–∂–µ–Ω—Ç–ª—å–º–µ–Ω–∞">–®–ª—è–ø–∞ –¥–∂–µ–Ω—Ç–ª—å–º–µ–Ω–∞</option>
            <option value="–û—á–∫–∏ –∑–≤–µ–∑–¥—ã">–û—á–∫–∏ –∑–≤–µ–∑–¥—ã</option>
          </select>
          <button class="btn" id="giveAcc">–í—ã–¥–∞—Ç—å</button>
        </div>
        <div class="muted" style="margin-top:8px">–≠—Ç–æ –Ω–µ –¥–æ–Ω–∞—Ç, –∞ —É–¥–æ–±–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞—Ç–µ–ª—è. –í–∏–¥–∏—à—å —Ç–æ–ª—å–∫–æ —Ç—ã.</div>
      `;
      wrap.append(block);
      byId("giveSeeds").onclick = ()=>{
        const n = Number(byId("giveAmount").value)||0;
        state.seeds += Math.max(0,n); save(); render(); tg?.HapticFeedback?.notificationOccurred?.("success")
      }
      byId("giveAcc").onclick = ()=>{
        const v = byId("accSel").value;
        if(!state.accessories.includes(v)) state.accessories.push(v);
        save(); buildInv(); tg?.HapticFeedback?.notificationOccurred?.("success")
      }
    }

    // ====== OPENERS ======
    byId("openShop").onclick       = ()=>{ buildShop(); open("modalShop") }
    byId("openInv").onclick        = ()=>{ buildInv(); open("modalInv") }
    byId("openQuests").onclick     = ()=>{ buildQuests(); open("modalQuests") }
    byId("openMini").onclick       = ()=>{ open("modalMini") }
    byId("openLeaderboard").onclick= ()=>{ buildLB(); open("modalLb") }
    byId("openAdmin").onclick      = ()=>{ buildAdmin(); open("modalAdmin") }

    // ====== 3D SCENE ======
    const HAMSTER_GLB = encodeURI("./the_hamster_who_got_tired_of_the_wheel (1).glb"); // –∏–ª–∏ "./hamster.glb"
    const canvas = document.getElementById("scene");
    const renderer = new THREE.WebGLRenderer({canvas, antialias:true, alpha:true});
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(35, 1, 0.1, 100);
    camera.position.set(0, 0.6, 2.1);
    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableZoom = false; controls.enablePan = false; controls.autoRotate = true; controls.autoRotateSpeed = 1.4;

    const hemi = new THREE.HemisphereLight(0xffffff, 0x223344, 0.9); scene.add(hemi);
    const dir  = new THREE.DirectionalLight(0xffffff, 0.8); dir.position.set(2,2,2); scene.add(dir);

    // ¬´–ø–æ–ª¬ª
    const g = new THREE.CircleGeometry(1.6, 48);
    const m = new THREE.MeshStandardMaterial({color:0x26486f, metalness:.2, roughness:.8});
    const floor = new THREE.Mesh(g, m); floor.rotation.x = -Math.PI/2; floor.position.y = -0.45; scene.add(floor);

    const loader = new GLTFLoader();
    let model;
    loader.load(HAMSTER_GLB, (glb)=>{
      model = glb.scene;
      // –ù–û–†–ú. –†–ê–ó–ú–ï–† –ò –ü–û–õ–û–ñ–ï–ù–ò–ï
      model.scale.set(2.8, 2.8, 2.8);
      model.position.set(0, -0.35, 0);
      scene.add(model);
    });

    function resize(){
      const w = canvas.clientWidth, h = canvas.clientHeight;
      renderer.setSize(w, h, false); camera.aspect = w/h; camera.updateProjectionMatrix();
    }
    const ro = new ResizeObserver(resize); ro.observe(canvas);
    function loop(){
      requestAnimationFrame(loop); controls.update(); renderer.render(scene, camera)
    }
    resize(); loop();
  </script>
</body>
</html>
