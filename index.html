<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tamagocho ‚Ä¢ 3D Hamster</title>
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <style>
    :root{
      --bg:#0f1620; --card:#151e2f; --text:#e6eef8; --muted:#9bb2d0;
      --accent:#08D28E; --ok:#34d399; --warn:#f59e0b; --danger:#ef4444;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,Segoe UI,Roboto,Arial}
    .wrap{max-width:920px;margin:0 auto;padding:18px 16px 40px}
    .card{background:var(--card);border-radius:20px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .header{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid rgba(255,255,255,.06)}
    .title{font-size:18px;font-weight:700}
    .muted{color:var(--muted)}
    .viewport{height:420px;border-radius:16px;margin:16px;overflow:hidden;border:1px solid rgba(255,255,255,.06)}
    .panel{padding:14px 16px;display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .btn{
      appearance:none;border:0;background:#1e293b;color:#e5f0ff;
      padding:10px 14px;border-radius:12px;cursor:pointer;font-weight:600;
      box-shadow:0 6px 18px rgba(0,0,0,.25);
      transition:.15s transform ease,.15s filter ease;
    }
    .btn:hover{filter:brightness(1.05)} .btn:active{transform:translateY(1px)}
    .btn.primary{background:linear-gradient(135deg,#22c55e,#06b6d4)}
    .btn.warn{background:linear-gradient(135deg,#f59e0b,#ef4444)}
    .pill{padding:6px 10px;border-radius:999px;background:#0b1220;border:1px solid rgba(255,255,255,.07)}
    .stat{flex:1;min-width:180px;background:#0b1220;border-radius:12px;padding:10px 12px;border:1px solid rgba(255,255,255,.06)}
    .bar{height:8px;background:#0b1322;border-radius:999px;overflow:hidden;margin-top:8px}
    .bar>i{display:block;height:100%;background:linear-gradient(90deg,#34d399,#22d3ee)}
    .grid{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:10px}
    @media (max-width:720px){ .grid{grid-template-columns:repeat(2,minmax(0,1fr))} }
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:flex-end;justify-content:center;z-index:40}
    .sheet{width:min(920px,100%);max-height:80dvh;background:var(--card);border-radius:16px 16px 0 0;overflow:auto}
    .sheet h3{margin:0;padding:16px;border-bottom:1px solid rgba(255,255,255,.06)}
    .sheet .content{padding:14px 16px}
    .item{display:flex;align-items:center;gap:12px;background:#0b1220;border:1px solid rgba(255,255,255,.06);padding:10px;border-radius:12px}
    .item img{width:48px;height:48px;border-radius:10px;object-fit:cover}
    .grow{flex:1}
    .right{margin-left:auto}
    .badge{padding:4px 8px;background:#0b1220;border:1px solid rgba(255,255,255,.07);border-radius:999px}
    a.link{color:#9bd4ff;text-decoration:none}
    .footer-note{color:#8aa3c2;font-size:12px;text-align:center;margin-top:16px}
  </style>

  <!-- Three.js + helpers -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.160.1/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.160.1/examples/js/controls/OrbitControls.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.160.1/examples/js/loaders/GLTFLoader.js"></script>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="header">
        <div class="title">üêπ Tamagocho</div>
        <div class="pill">Seeds: <b id="seeds">250</b></div>
      </div>

      <!-- 3D Viewport -->
      <div class="viewport" id="viewport"></div>

      <!-- Stats -->
      <div class="panel row">
        <div class="stat">
          <div>üíö –°—ã—Ç–æ—Å—Ç—å <span class="right badge" id="hungerLabel">80%</span></div>
          <div class="bar"><i id="hungerBar" style="width:80%"></i></div>
        </div>
        <div class="stat">
          <div>‚ö°Ô∏è –≠–Ω–µ—Ä–≥–∏—è <span class="right badge" id="energyLabel">75%</span></div>
          <div class="bar"><i id="energyBar" style="width:75%"></i></div>
        </div>
        <div class="stat">
          <div>üòä –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ <span class="right badge" id="moodLabel">90%</span></div>
          <div class="bar"><i id="moodBar" style="width:90%"></i></div>
        </div>
      </div>

      <!-- Actions -->
      <div class="panel row">
        <button class="btn primary" id="btnFeed">–ö–æ—Ä–º–∏—Ç—å</button>
        <button class="btn primary" id="btnPlay">–ò–≥—Ä–∞—Ç—å</button>
        <button class="btn" id="btnSleep">–°–ø–∞—Ç—å</button>
        <button class="btn" id="btnQuests">–ö–≤–µ—Å—Ç—ã</button>
        <button class="btn" id="btnShop">–ú–∞–≥–∞–∑–∏–Ω</button>
        <button class="btn warn" id="btnMiniGame">–ú–∏–Ω–∏-–∏–≥—Ä–∞</button>
      </div>
    </div>

    <div class="footer-note">
      –ï—Å–ª–∏ –º–æ–¥–µ–ª—å –Ω–µ –≤–∏–¥–Ω–∞ ‚Äî –ø—Ä–æ–≤–µ—Ä—å –∏–º—è —Ñ–∞–π–ª–∞ –∏ —Å—Ç—Ä–æ–∫—É <code>HAMSTER_URL</code> –≤ —ç—Ç–æ–º html.
    </div>
  </div>

  <!-- SHOP -->
  <div class="modal" id="shopModal">
    <div class="sheet">
      <h3>üõí –ú–∞–≥–∞–∑–∏–Ω</h3>
      <div class="content grid" id="shopList">
        <!-- –¢–æ–≤–∞—Ä—ã –≤—Å—Ç–∞–≤–ª—è–µ—Ç JS -->
      </div>
      <div class="content">
        <button class="btn" onclick="closeShop()">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
    </div>
  </div>

  <!-- QUESTS -->
  <div class="modal" id="questsModal">
    <div class="sheet">
      <h3>üìú –ö–≤–µ—Å—Ç—ã</h3>
      <div class="content" id="questsList"></div>
      <div class="content">
        <button class="btn" onclick="closeQuests()">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
    </div>
  </div>

  <!-- MINI GAME (–∑–∞–≥–ª—É—à–∫–∞) -->
  <div class="modal" id="miniModal">
    <div class="sheet">
      <h3>üéÆ –ú–∏–Ω–∏-–∏–≥—Ä–∞</h3>
      <div class="content">
        <p class="muted">–ú–∏–Ω–∏-–∏–≥—Ä–∞ –ø–æ–∫–∞ –∑–∞–≥–ª—É—à–∫–∞. –°–¥–µ–ª–∞–π 10 –∫–ª–∏–∫–æ–≤ ‚Äî –ø–æ–ª—É—á–∏ 15 Seeds.</p>
        <div class="row">
          <button class="btn primary" id="mgClick">–ö–ª–∏–∫!</button>
          <div class="pill">–ö–ª–∏–∫–æ–≤: <b id="mgCount">0</b>/10</div>
        </div>
      </div>
      <div class="content">
        <button class="btn" onclick="closeMini()">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
    </div>
  </div>

  <script>
  /* =============================
      SIMPLE STATE
  ==============================*/
  const $ = (s, p=document)=>p.querySelector(s);
  const $$ = (s, p=document)=>p.querySelectorAll(s);

  const S = {
    seeds: 250, hunger: 80, energy: 75, mood: 90,
    inv: {},
  };

  function renderStats(){
    $('#seeds').textContent = S.seeds;
    $('#hungerLabel').textContent = S.hunger + '%';
    $('#energyLabel').textContent = S.energy + '%';
    $('#moodLabel').textContent   = S.mood   + '%';
    $('#hungerBar').style.width = S.hunger + '%';
    $('#energyBar').style.width = S.energy + '%';
    $('#moodBar').style.width   = S.mood   + '%';
  }

  function clamp(v,min=0,max=100){ return Math.max(min,Math.min(max,v)); }

  // Items(shop)
  const SHOP = [
    { id:'feed1',  title:'–ó—ë—Ä–Ω–∞',  desc:'+20 —Å—ã—Ç–æ—Å—Ç–∏',  price:30,  onUse:()=>{ S.hunger = clamp(S.hunger+20); } },
    { id:'toy1',   title:'–ü–æ–≥—Ä–µ–º—É—à–∫–∞', desc:'–∏–≥—Ä–∞: +15 –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è', price:25, onUse:()=>{ S.mood = clamp(S.mood+15);} },
    { id:'bed1',   title:'–ü–æ–¥—Å—Ç–∏–ª–∫–∞',  desc:'+20 —ç–Ω–µ—Ä–≥–∏–∏', price:40, onUse:()=>{ S.energy = clamp(S.energy+20);} },
    { id:'bath1',  title:'–ü–µ—Å—á–∞–Ω–∞—è –≤–∞–Ω–Ω–∞', desc:'–∫–æ–º–±–æ +10 –∫–æ –≤—Å–µ–º', price:50, onUse:()=>{ S.hunger=clamp(S.hunger+10); S.energy=clamp(S.energy+10); S.mood=clamp(S.mood+10);} }
  ];

  function openShop(){
    const root = $('#shopList');
    root.innerHTML = '';
    SHOP.forEach(it=>{
      const div = document.createElement('div');
      div.className='item';
      div.innerHTML = `
        <img src="https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f35e.png" alt="">
        <div class="grow">
          <div><b>${it.title}</b></div>
          <div class="muted">${it.desc}</div>
        </div>
        <div class="badge">üí† ${it.price}</div>
        <button class="btn primary right">–ö—É–ø–∏—Ç—å</button>
      `;
      div.querySelector('button').onclick = ()=>{
        if(S.seeds < it.price){ alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ Seeds'); return; }
        S.seeds -= it.price;
        it.onUse();
        renderStats();
      };
      root.appendChild(div);
    });
    $('#shopModal').style.display='flex';
  }
  function closeShop(){ $('#shopModal').style.display='none'; }

  // Quests
  const QUESTS = [
    { id:'q1',title:'–ü–æ–∫–æ—Ä–º–∏—Ç—å –¥—Ä—É–≥–∞', reward:25, done:false, check:()=>S.hunger>=90 },
    { id:'q2',title:'–ü–æ–∏–≥—Ä–∞—Ç—å',         reward:25, done:false, check:()=>S.mood>=95 },
    { id:'q3',title:'–û—Ç–¥–æ—Ö–Ω—É—Ç—å',        reward:25, done:false, check:()=>S.energy>=90 },
  ];
  function openQuests(){
    const root = $('#questsList');
    root.innerHTML='';
    QUESTS.forEach(q=>{
      const ok = q.check();
      const div = document.createElement('div');
      div.className='item';
      div.innerHTML = `
        <img src="https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f4da.png">
        <div class="grow">
          <div><b>${q.title}</b></div>
          <div class="muted">–ù–∞–≥—Ä–∞–¥–∞: üí† ${q.reward}</div>
        </div>
        <div class="badge">${q.done? '–í—ã–ø–æ–ª–Ω–µ–Ω–æ' : (ok?'–ì–æ—Ç–æ–≤–æ –∫ —Å–¥–∞—á–µ':'–ù–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ')}</div>
        <button class="btn primary right" ${q.done||!ok?'disabled':''}>–ó–∞–±—Ä–∞—Ç—å</button>
      `;
      div.querySelector('button').onclick = ()=>{
        if(q.done) return;
        if(!q.check()) return alert('–°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏ –∑–∞–¥–∞–Ω–∏–µ.');
        q.done=true; S.seeds += q.reward; renderStats(); openQuests();
      };
      root.appendChild(div);
    });
    $('#questsModal').style.display='flex';
  }
  function closeQuests(){ $('#questsModal').style.display='none'; }

  // Mini-game (simple)
  let mgCount = 0;
  function openMini(){
    mgCount = 0; $('#mgCount').textContent=mgCount;
    $('#miniModal').style.display='flex';
  }
  function closeMini(){ $('#miniModal').style.display='none'; }

  /* =============================
      3D SCENE
  ==============================*/
  const VP = $('#viewport');

  // –ï—Å–ª–∏ –ù–ï –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞–ª ‚Äî —Ñ–∞–π–ª —Å –ø—Ä–æ–±–µ–ª–∞–º–∏ –∏ —Å–∫–æ–±–∫–∞–º–∏:
  const HAMSTER_URL = "./hamster.glb";

  // –ï—Å–ª–∏ –ø–µ—Ä–µ–∏–º–µ–Ω—É–µ—à—å —Ñ–∞–π–ª –≤ hamster.glb ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π —Ç–∞–∫:
  // const HAMSTER_URL = "./hamster.glb";

  let scene, camera, renderer, controls, mixer;

  function init3D(){
    const w = VP.clientWidth, h = VP.clientHeight;

    scene = new THREE.Scene();
    scene.background = new THREE.Color(0x0b1220);

    camera = new THREE.PerspectiveCamera(45, w/h, 0.01, 50);
    camera.position.set(0, 0.7, 2.2);

    renderer = new THREE.WebGLRenderer({ antialias:true, alpha:false, powerPreference:'high-performance' });
    renderer.outputEncoding = THREE.sRGBEncoding;
    renderer.shadowMap.enabled = true;
    renderer.setPixelRatio(Math.min(devicePixelRatio, 2));
    renderer.setSize(w, h, true);
    VP.appendChild(renderer.domElement);

    controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.target.set(0, 0.3, 0);

    // light
    const hemi = new THREE.HemisphereLight(0xffffff, 0x1b2843, .9);
    scene.add(hemi);

    const dir = new THREE.DirectionalLight(0xffffff, 1.0);
    dir.position.set(3, 3, 3);
    dir.castShadow = true;
    dir.shadow.mapSize.set(1024, 1024);
    scene.add(dir);

    // –º—è–≥–∫–∞—è –ø–æ–¥–ª–æ–∂–∫–∞
    const g = new THREE.CircleGeometry(1.5, 64);
    const m = new THREE.MeshStandardMaterial({ color:0x0e1726, metalness:.1, roughness:.9 });
    const ground = new THREE.Mesh(g, m); ground.rotation.x = -Math.PI/2; ground.receiveShadow = true;
    scene.add(ground);

    // GLB loader
    const loader = new THREE.GLTFLoader();
    loader.setCrossOrigin('anonymous');

    loader.load(
      HAMSTER_URL,
      (glb)=>{
        const root = glb.scene;
        root.traverse(o=>{
          if(o.isMesh){ o.castShadow = true; o.receiveShadow = true; }
        });

        // –∞–≤—Ç–æ-—Ü–µ–Ω—Ç—Ä–æ–≤–∫–∞ –∏ –º–∞—Å—à—Ç–∞–±
        const box = new THREE.Box3().setFromObject(root);
        const size = new THREE.Vector3();
        const center = new THREE.Vector3();
        box.getSize(size);
        box.getCenter(center);

        root.position.x -= center.x;
        root.position.y -= center.y;
        root.position.z -= center.z;

        const maxDim = Math.max(size.x, size.y, size.z);
        const wanted = 1.2;
        if(maxDim > 0){
          const scale = wanted / maxDim;
          root.scale.setScalar(scale);
        }

        scene.add(root);

        // –∞–Ω–∏–º–∞—Ü–∏—è, –µ—Å–ª–∏ –µ—Å—Ç—å
        if(glb.animations && glb.animations.length){
          mixer = new THREE.AnimationMixer(root);
          const act = mixer.clipAction(glb.animations[0]);
          act.play();
        }

        // –ø–æ–¥–≥–æ–Ω –∫–∞–º–µ—Ä—ã
        const fov = camera.fov * (Math.PI/180);
        const dist = (wanted * 0.6) / Math.tan(fov/2);
        camera.position.set(0, wanted*0.5, dist + 0.5);
        controls.target.set(0, 0.3, 0);
        controls.update();
      },
      undefined,
      (err)=>{
        console.warn('GLB load error:', err);
        const msg = document.createElement('div');
        msg.style.cssText = 'position:absolute;inset:0;display:flex;align-items:center;justify-content:center;color:#fff;background:#0b1220';
        msg.textContent = '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –º–æ–¥–µ–ª—å. –ü—Ä–æ–≤–µ—Ä—å –∏–º—è —Ñ–∞–π–ª–∞ –∏ HAMSTER_URL.';
        VP.appendChild(msg);
      }
    );

    window.addEventListener('resize', onResize);
    animate();
  }

  function onResize(){
    const w = VP.clientWidth, h = VP.clientHeight;
    camera.aspect = w/h; camera.updateProjectionMatrix();
    renderer.setSize(w, h, true);
  }

  function animate(t=0){
    requestAnimationFrame(animate);
    if(mixer) mixer.update(0.016);
    controls.update();
    renderer.render(scene, camera);
  }

  /* =============================
      UI WIRING
  ==============================*/
  $('#btnFeed').onclick = ()=>{ S.hunger = clamp(S.hunger+15); S.seeds = Math.max(0,S.seeds-5); renderStats(); };
  $('#btnPlay').onclick = ()=>{ S.mood   = clamp(S.mood+15);   S.energy = clamp(S.energy-5); renderStats(); };
  $('#btnSleep').onclick = ()=>{ S.energy = clamp(S.energy+20); S.mood=clamp(S.mood-5); renderStats(); };

  $('#btnShop').onclick = openShop;
  $('#btnQuests').onclick = openQuests;
  $('#btnMiniGame').onclick = openMini;

  $('#mgClick')?.addEventListener('click', ()=>{
    mgCount++; $('#mgCount').textContent = mgCount;
    if(mgCount>=10){ S.seeds += 15; renderStats(); alert('–ü–æ–±–µ–¥–∞! +15 Seeds'); closeMini(); }
  });

  // init
  renderStats();
  init3D();
  </script>
</body>
</html>
